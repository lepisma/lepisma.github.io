<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-06-08 Fri 10:03 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fancy Little Lisp λs</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Abhinav Tushar">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="/assets/css/pace.css" />
<link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.css" />
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,800" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono" >
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="/assets/js/pace.min.js"></script>
<script src="/assets/js/jquery.zoomooz.min.js"></script>
<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/favicons/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/favicons/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/favicons/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/favicons/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/favicons/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/favicons/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/favicons/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/favicons/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="/assets/favicons/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="/assets/favicons/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="/assets/favicons/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/assets/favicons/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/assets/favicons/favicon-128.png" sizes="128x128" />
<meta name="application-name" content="&nbsp;" />
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="/assets/favicons/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="/assets/favicons/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="/assets/favicons/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="/assets/favicons/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="/assets/favicons/mstile-310x310.png" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<header>
                                <div class='site-title'>
                                  <a href='/'>
                                    <img src='/assets/images/avatar32.png'>
                                  </a>
                                </div>
                                <div class='site-nav'>
                                  <a class='active' href='/'> blog</a>
                                  <a class='' href='/journal'> journal</a>
                                  <a class='' href='/wiki'> wiki</a>
                                  <a href='/about'> about</a>
                                </div>
                                <div class='clearfix'></div>
                              </header>

                              <div class='page-header'>
                                <div class='page-meta'>2017-12-20 Wed 00:00</div>
                                <h1>Fancy Little Lisp λs</h1>
                              </div>
</div>
<div id="content">
<div class='page-tags'><a href='../../..#lisp'>lisp</a> <a href='../../..#programming'>programming</a></div>
<p>
<span class='dropcap'>T</span>his year, I am trying to get my hands on <a href="https://adventofcode.com/">Advent of Code</a>. One of my aims is to
try out programming languages with varying paradigms. As of now, I have
attempted the days (problems) <a href="https://github.com/lepisma/advent-of-code">intermittently</a> and have not been changing
languages that often too, mostly employing Common Lisp. One side effect of that
has been a chance to have a deeper look into the CL's package ecosystem.
</p>

<p>
On first sight, you will notice that a lot of Common Lisp packages are old.
Really old. It feels like you don't have a lot of options. I actually started a
github project for collecting various handy macros/functions I use (or have
seen) in Emacs Lisp, Racket, Clojure etc. In the process, what I found was that
many of these are already present in CL. They are just spread out over lots of
packages (with lot of duplication). An interesting set of Lisp macros that I
have recently started to like is one that provides shortcuts for expressing λ
functions. In this post, I try to knot up the options in Common Lisp for these
little beauties.
</p>

<hr>

<p>
Working in Lisp (or any language with functional inclinations) makes you use a
lot of partially applied functions. Consider a list of numbers that you want to
increment by 1. In Common Lisp this would be something like:
</p>

<div class="org-src-container">
<pre class="src src-lisp">(mapcar (<span class="org-keyword">lambda</span> (n) (+ <span class="org-highlight-numbers-number">1</span> n)) '(<span class="org-highlight-numbers-number">1</span> <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">3</span> <span class="org-highlight-numbers-number">4</span> <span class="org-highlight-numbers-number">5</span> <span class="org-highlight-numbers-number">6</span><span class="org-parinfer-pretty-parensXdim-paren">))</span>
</pre>
</div>

<p>
The <code>lambda</code> in the middle really is just creating a partially applied version
of the function <code>#'+</code> with the first argument set to 1. Now, writing this much
code (<code>(lambda (n) (+ 1 n))</code>) for a simple function can get really boring. In
this specific case, since we already have a unary function <code>#'1+</code>, we can get
rid of the boilerplate like this:
</p>

<div class="org-src-container">
<pre class="src src-lisp">(mapcar #'1+ '(<span class="org-highlight-numbers-number">1</span> <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">3</span> <span class="org-highlight-numbers-number">4</span> <span class="org-highlight-numbers-number">5</span> <span class="org-highlight-numbers-number">6</span><span class="org-parinfer-pretty-parensXdim-paren">))</span>
</pre>
</div>

<p>
But, in general, you need to use the full <code>lambda</code> form. Some Lisps, like
<a href="https://hylang.org">hy</a> provide a shorter name like <code>fn</code> which is neat, but
given that we have macros in hand there can be much cleaner solutions.
</p>

<div id="outline-container-org39d1b92" class="outline-2">
<h2 id="cut"><a id="org39d1b92"></a><span class="section-number-2">1</span> Cut</h2>
<div class="outline-text-2" id="text-cut">

<p>
One of the solutions I first came across is the <code>-cut</code> macro in Emacs Lisp from
<a href="https://github.com/magnars/dash.el#-cut-rest-params">dash.el</a>. This has its origin in <a href="https://srfi.schemers.org/srfi-26/srfi-26.html">SRFI-26</a> where a one line description says
<i>Notation for Specializing Parameters without Currying</i>.
</p>

<aside>
<p>
Currying is a process of converting an <i>n-ary</i> function into a chain of <i>unary</i>
ones. This is different from what <i>cut</i>'s specification says. Cut returns a
single new function with arbitrary positions filled in. Currying returns a chain
which can then be applied sequentially to arguments. Here is an example of what
currying does in <a href="https://racket-lang.org/">Racket</a>:
</p>

<div class="org-src-container">
<pre class="src src-racket">(<span class="org-builtin">expt</span> <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">5</span><span class="org-parinfer-pretty-parensXdim-paren">)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">32</span>

(<span class="org-builtin">curry</span> <span class="org-builtin">expt</span><span class="org-parinfer-pretty-parensXdim-paren">)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">#&lt;procedure:curried&gt;</span>

((<span class="org-builtin">curry</span> <span class="org-builtin">expt</span>) <span class="org-highlight-numbers-number">2</span><span class="org-parinfer-pretty-parensXdim-paren">)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">#&lt;procedure:curried&gt;</span>

(((<span class="org-builtin">curry</span> <span class="org-builtin">expt</span>) <span class="org-highlight-numbers-number">2</span>) <span class="org-highlight-numbers-number">5</span><span class="org-parinfer-pretty-parensXdim-paren">)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">32</span>
</pre>
</div>
</aside>

<p>
In Common Lisp we have <a href="http://quickdocs.org/cl-cut/">cl-cut</a> which follows
Scheme's cut specification more completely (as compared to dash in elisp). If
you want to (say) replace <code>?</code> with <code>!</code> in a list of strings, a cut based
solution would be:
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">cut is from cl-cut</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">replace-all is from cl-strings</span>
(mapcar (cut replace-all &lt;&gt; <span class="org-string">"?"</span> <span class="org-string">"!"</span>) items<span class="org-parinfer-pretty-parensXdim-paren">)</span>
</pre>
</div>

<p>
Compare that with the full λ version:
</p>

<div class="org-src-container">
<pre class="src src-lisp">(mapcar (<span class="org-keyword">lambda</span> (s) (replace-all s <span class="org-string">"?"</span> <span class="org-string">"!"</span>)) items<span class="org-parinfer-pretty-parensXdim-paren">)</span>
</pre>
</div>

<p>
Not a lot different, but why complicate things if there are shorter ways? Just
like in functions, anonymity in arguments helps when the effective <i>name</i> is
clear from context. Cut also allows expressing multiple arguments and λs with
<code>&amp;rest</code>:
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Replace ? with different string in different items</span>
(mapcar (cut replace-all &lt;&gt; <span class="org-string">"?"</span> &lt;&gt;) items replacements<span class="org-parinfer-pretty-parensXdim-paren">)</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">Taken from http://quickdocs.org/cl-cut/</span>
(cut list <span class="org-highlight-numbers-number">1</span> &lt;&gt; <span class="org-highlight-numbers-number">3</span> &lt;...&gt;<span class="org-parinfer-pretty-parensXdim-paren">)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">is equivalent to the following</span>
(<span class="org-keyword">lambda</span> (x2 <span class="org-type">&amp;rest</span> xs<span class="org-parinfer-pretty-parensXdim-paren">)</span>
  (apply #'list <span class="org-highlight-numbers-number">1</span> x2 <span class="org-highlight-numbers-number">3</span> xs<span class="org-parinfer-pretty-parensXdim-paren">))</span>
</pre>
</div>

<p>
One decision made in cut is to only allow <code>&lt;&gt;</code> in flat positions, i.e. the
placeholder <code>&lt;&gt;</code> can not be hidden inside parentheses like in the following
case:
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">This doesn't work</span>
(funcall (cut + <span class="org-highlight-numbers-number">2</span> (* &lt;&gt; <span class="org-highlight-numbers-number">3</span>)) <span class="org-highlight-numbers-number">3</span><span class="org-parinfer-pretty-parensXdim-paren">)</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">&lt;&gt; inside lists are not detected while generating the argument list</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(macroexpand '(cut + 2 (* &lt;&gt; 3))) gives</span>
(<span class="org-keyword">lambda</span> () (+ <span class="org-highlight-numbers-number">2</span> (* &lt;&gt; <span class="org-highlight-numbers-number">3</span><span class="org-parinfer-pretty-parensXdim-paren">)))</span>
</pre>
</div>

<p>
Sometimes this nesting is needed. For example, if you are converting a list of
temperature given in °F to °C, you might want to be able to write something
like:
</p>

<div class="org-src-container">
<pre class="src src-lisp">(mapcar (cut * (/ <span class="org-highlight-numbers-number">5</span> <span class="org-highlight-numbers-number">9</span>) (- &lt;&gt; <span class="org-highlight-numbers-number">32</span>)) temperatures<span class="org-parinfer-pretty-parensXdim-paren">)</span>
</pre>
</div>

<p>
If you need only unary functions, a simple solution is to make an anaphoric
version of λ which captures <code>&lt;&gt;</code>:
</p>

<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defmacro</span> <span class="org-function-name">acut</span> (<span class="org-type">&amp;rest</span> body<span class="org-parinfer-pretty-parensXdim-paren">)</span>
  `(<span class="org-keyword">lambda</span> (&lt;&gt;) ,@body<span class="org-parinfer-pretty-parensXdim-paren">))</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">This works now</span>
(mapcar (acut * (/ <span class="org-highlight-numbers-number">5</span> <span class="org-highlight-numbers-number">9</span>) (- &lt;&gt; <span class="org-highlight-numbers-number">32</span>)) temperatures<span class="org-parinfer-pretty-parensXdim-paren">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf8c8b6" class="outline-2">
<h2 id="xi"><a id="orgdf8c8b6"></a><span class="section-number-2">2</span> Xi</h2>
<div class="outline-text-2" id="text-xi">

<p>
This is another fancy way of creating λs that I came to know from
<a href="https://hylang.org">hy</a>. Although its name is going to be changed in
<a href="https://github.com/hylang/hy/blob/862732ff2a96b811d9b1f077843cd89bb1049099/hy/extra/anaphoric.hy#L114">a
while</a>, according to
<a href="http://docs.hylang.org/en/stable/extra/anaphoric.html#xi">current stable
docs</a>, its usage is like this:
</p>

<div class="org-src-container">
<pre class="src src-hy"><span class="org-comment-delimiter">;; </span><span class="org-comment">(require [hy.extra.anaphoric [*]])</span>
(<span class="org-builtin">xi</span> <span class="org-builtin">-</span> x1 x2<span class="org-parinfer-pretty-parensXdim-paren">)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">This is equivalent to</span>
(<span class="org-keyword">fn</span> [x1 x2] (<span class="org-builtin">-</span> x1 x2)) <span class="org-comment">; Not that `lambda` is called `fn` in Hy</span>
</pre>
</div>

<p>
The important thing to notice is that <code>xi</code> supports positional arguments (and
also nesting) by using the number in the placeholders <code>x1</code>, <code>x2</code> etc. For
example, consider the following snippet:
</p>

<div class="org-src-container">
<pre class="src src-hy"><span class="org-comment-delimiter">;; </span><span class="org-comment">Hy</span>
((<span class="org-builtin">xi</span> <span class="org-builtin">-</span> (<span class="org-builtin">+</span> x1 x2) x3) <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">5</span> <span class="org-highlight-numbers-number">10</span>) <span class="org-comment-delimiter">;; </span><span class="org-comment">-3</span>
((<span class="org-builtin">xi</span> <span class="org-builtin">-</span> (<span class="org-builtin">+</span> x2 x3) x1) <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">5</span> <span class="org-highlight-numbers-number">10</span>) <span class="org-comment-delimiter">;; </span><span class="org-comment">13</span>
</pre>
</div>

<p>
Xi really is inspired by Clojure's
<a href="https://clojure.org/guides/learn/functions#_anonymous_functions">anonymous
function syntax</a> which is pretty powerful:
</p>

<div class="org-src-container">
<pre class="src src-clojure">#(+ 10 %)         ;; % acts similar to &lt;&gt; in cut
#(- %1 (+ %3 %2)) ;; We have nesting and positional arguments (%i)
#(some-fun % %&amp;)  ;; We have &amp;rest (as %&amp;) too
</pre>
</div>

<p>
Closest looking syntax for this in Common Lisp (at least from what I found out)
is of the <code>#L</code> reader macro from
<a href="https://common-lisp.net/project/bese/docs/arnesi/html/api/function_005FIT.BESE.ARNESI_003A_003ASHARPL-READER.html">arnesi</a>
and <code>^</code> macro from
<a href="https://github.com/cl21/cl21/blob/master/doc/Reader_Macros.markdown#-3">CL21</a>.
Using <code>#L</code>, the above examples in clojure translates to the following Common
Lisp code
</p>

<aside>
<p>
Arnesi is not recommended for use though. The
<a href="http://quickdocs.org/arnesi/">version on quicklisp</a> is an unmaintained fork
and suggests switching to newer libraries.
</p>
</aside>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Need to enable sharp-l reader macro</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(arnesi:enable-sharp-l-syntax)</span>
#L(+ <span class="org-highlight-numbers-number">10</span> !1)         <span class="org-comment-delimiter">;; </span><span class="org-comment">!i for position i</span>
#L(- !1 (+ !3 !2<span class="org-parinfer-pretty-parensXdim-paren">))</span>
                    <span class="org-comment-delimiter">;; </span><span class="org-comment">No &amp;rest arguments here</span>
</pre>
</div>

<p>
In CL21, you have:
</p>

<div class="org-src-container">
<pre class="src src-lisp">^(+ <span class="org-highlight-numbers-number">10</span> %<span class="org-parinfer-pretty-parensXdim-paren">)</span>
^(- %1 (+ %3 %2<span class="org-parinfer-pretty-parensXdim-paren">))</span>
                    <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't know if &amp;rest is supported yet</span>
</pre>
</div>

<p>
Another option is <a href="http://quickdocs.org/positional-lambda/">positional-lambda</a>
where Clojure's examples go like the following:
</p>

<div class="org-src-container">
<pre class="src src-lisp">(plambda (+ <span class="org-highlight-numbers-number">10</span> <span class="org-builtin">:1</span>))            <span class="org-comment-delimiter">;; </span><span class="org-comment">:i for position i</span>
(plambda (- <span class="org-builtin">:1</span> (+ <span class="org-builtin">:3</span> <span class="org-builtin">:2</span><span class="org-parinfer-pretty-parensXdim-paren">)))</span>
(plambda (some-fun <span class="org-builtin">:1</span> <span class="org-builtin">:rest</span>))  <span class="org-comment-delimiter">;; </span><span class="org-comment">&amp;rest is supported</span>
</pre>
</div>

<hr>

<p>
Although using complicated λs signals that you better reconsider your decision
of <i>not</i> creating dedicated functions, these fancier variants are pretty useful.
</p>

<p>
Here is a listing of Common Lisp packages mentioned in this post and some other
which are similar in the sense that they allow creating/manipulating functions:
</p>

<ul class="org-ul">
<li><a href="http://quickdocs.org/cl-cut/">cl-cut</a> for <code>cut</code> (and <code>cute</code>) syntax from <a href="https://srfi.schemers.org/srfi-26/srfi-26.html">SRFI-26</a></li>
<li><a href="http://quickdocs.org/arnesi/">arnesi</a> for the <code>#L</code> reader macro.</li>
<li><a href="https://github.com/cl21/cl21">CL21</a> for the <code>^</code> macro. Not on quicklisp main repos but can be installed using
ql. Instructions on project's page.</li>
<li><a href="http://quickdocs.org/positional-lambda/">positional-lambda</a> for <code>plambda</code> macro.</li>
<li>There is also <code>#`-reader</code> in <a href="https://github.com/vseloved/rutils">rutils</a> providing Clojure-ish but slightly limited
shorthands</li>
</ul>

<div class="org-src-container">
<pre class="src src-lisp">#`(+ <span class="org-highlight-numbers-number">2</span> %) <span class="org-comment">; =&gt; (lambda (&amp;optional x y) (+ 2 x)) </span>
#`((print %) (1+ %)) <span class="org-comment">; =&gt; (lambda (&amp;optional x) (print x) (1+ x))</span>
#`(+ % %%) <span class="org-comment">; =&gt; (lambda (&amp;optional x y) (+ x y)) </span>
</pre>
</div>
<ul class="org-ul">
<li><a href="https://github.com/cbaggers/fn">fn</a> provides another set of shorthands for λs. Examples from github page:</li>
</ul>

<div class="org-src-container">
<pre class="src src-lisp">(fn* (subseq _@ <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">2</span>)) <span class="org-comment">; =&gt;  (lambda (&amp;rest _@) (subseq _@ 0 2))</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">with reader macros for fn* forms too</span>
&#955;(+ _ _1) <span class="org-comment">; =&gt;  (lambda (_ _1) (+ _ _1))</span>
</pre>
</div>
<ul class="org-ul">
<li><a href="https://eschulte.github.io/curry-compose-reader-macros/">curry-compose-reader-macros</a> provides shorthand reader macros for currying and
composing functions. A few examples from the github page:</li>
</ul>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">partial application `</span><span class="org-comment"><span class="org-constant">curry</span></span><span class="org-comment">'</span>
(mapcar {+ 1} '(<span class="org-highlight-numbers-number">1</span> <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">3</span> <span class="org-highlight-numbers-number">4</span>)) <span class="org-comment">; =&gt; (2 3 4 5)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">function composition</span>
(mapcar [#'list {* 2}] '(<span class="org-highlight-numbers-number">1</span> <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">3</span> <span class="org-highlight-numbers-number">4</span>)) <span class="org-comment">; =&gt; ((2) (4) (6) (8))</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">function split and join</span>
(mapcar &#171;list {* 2} {* 3}&#187; '(<span class="org-highlight-numbers-number">1</span> <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">3</span> <span class="org-highlight-numbers-number">4</span>)) <span class="org-comment">; =&gt; ((2 3) (4 6) (6 9) (8 12))</span>
</pre>
</div>
<ul class="org-ul">
<li><a href="http://www.cliki.net/curly">curly</a> has two reader macros for currying and composition. Examples from
homepage</li>
</ul>

<div class="org-src-container">
<pre class="src src-lisp">'[foo bar * baz] <span class="org-comment">; =&gt; (lambda (#:g2709) (foo bar #:g2709 baz))</span>

'{foo (bar <span class="org-highlight-numbers-number">16</span>) (baz <span class="org-highlight-numbers-number">23</span> * <span class="org-highlight-numbers-number">42</span>) quux}
<span class="org-comment-delimiter">;; </span><span class="org-comment">=&gt; (lambda (#:g2724) (foo (bar 16 (baz 23 (quux #:g2724) 42)))</span>
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer id='footer'></footer>
</div>
</body>
</html>
