<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-06-08 Fri 10:03 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Simpler time map plots</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Abhinav Tushar">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="/assets/css/pace.css" />
<link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.css" />
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,800" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono" >
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="/assets/js/pace.min.js"></script>
<script src="/assets/js/jquery.zoomooz.min.js"></script>
<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/favicons/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/favicons/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/favicons/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/favicons/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/favicons/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/favicons/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/favicons/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/favicons/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="/assets/favicons/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="/assets/favicons/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="/assets/favicons/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/assets/favicons/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/assets/favicons/favicon-128.png" sizes="128x128" />
<meta name="application-name" content="&nbsp;" />
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="/assets/favicons/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="/assets/favicons/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="/assets/favicons/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="/assets/favicons/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="/assets/favicons/mstile-310x310.png" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="preamble" class="status">
<header>
                                <div class='site-title'>
                                  <a href='/'>
                                    <img src='/assets/images/avatar32.png'>
                                  </a>
                                </div>
                                <div class='site-nav'>
                                  <a class='active' href='/'> blog</a>
                                  <a class='' href='/journal'> journal</a>
                                  <a class='' href='/wiki'> wiki</a>
                                  <a href='/about'> about</a>
                                </div>
                                <div class='clearfix'></div>
                              </header>

                              <div class='page-header'>
                                <div class='page-meta'>2017-06-25 Sun 00:00</div>
                                <h1>Simpler time map plots</h1>
                              </div>
</div>
<div id="content">
<div class='page-tags'><a href='../../../..#exploration'>exploration</a> <a href='../../../..#viz'>viz</a></div>
<div class="page-intro">
<p>
Proposing a one dimensional version of <a href="https://districtdatalabs.silvrback.com/time-maps-visualizing-discrete-events-across-many-timescales">time map</a> plots which doesn't lose any
information displayed in most cases and is cleaner to understand.
</p>

</div>

<p>
<span class='dropcap'>B</span>ehavior of time series is tricky to judge from simple plots. The process
generating the series can have multiple underlying mechanics and simple plots
make it hard to discern these. Sometime back I read about <a href="https://districtdatalabs.silvrback.com/time-maps-visualizing-discrete-events-across-many-timescales">time maps</a>, which try
to solve a part of this problem (I encourage you to read that post before this
one). Time maps target visualizing time differences between discrete events.
This is helpful, for example, to see if there are multiple modes in the
repetition of some events. If on a single day you eat 5 times from 9 AM to 11 AM
and call it a day, your eating time plot will have repetitions for those small
intervals <i>and</i> for the daily one. A time map captures these two modes easily.
</p>

<p>
Consider the following time series. The x axis shows date and the y axis shows
my lastfm <a href="https://www.last.fm/user/abhinavtushar">scrobbles</a> per day.
</p>

<figure> <div id='counts-lfm'></div> <figcaption>
<p>
My daily lastfm scrobbles
</p>
</figcaption></figure>

<p>
Nothing much to it. If I plot it as a time map, I get this
</p>

<aside>
<p>
Scale is log; sorry for the <i>not that useful</i> tick labels in this whole post, <a href="https://github.com/lepisma/tufte.js/issues/21">will
fix it</a>.
</p>
</aside>

<figure> <div id='diffs-lfm-vanilla'></div> <figcaption>
<p>
Scrobbles time map
</p>
</figcaption></figure>

<p>
Each dot here is a listen. The \(x\) value being the time difference between it
and the previous listen, \(y\) being the difference with next listen. Note that
the plot is log scaled (thus the repeated pattern in lower values) which helps
us understand the diffs at multiple scales.
</p>

<p>
Another important point is the <i>almost</i> symmetry along \(x = y\) line. When you use
the <i>pre-event</i> and <i>post-event</i> time diffs of each event as \(x\) and \(y\) value for
plotting, one points \(x\) will be previous one's (according to event ordering)
\(y\) value. Now this has consequences on whether a time map is useful for you.
What follows is the same plot with marginal histograms along the axis. No doubt
the \(x\) and \(y\) marginals are similar. This is not because of the data but
because of the way both axis values are derived, resulting in a non-exact
symmetry.
</p>

<figure> <div id='diffs-lfm'></div> <figcaption>
<p>
Time map with marginals
</p>
</figcaption></figure>

<p>
Think about a point in top left corner. This refers to an event which was
preceded by another event shortly but is followed by the next event after a long
time gap. The opposite happens with point in bottom right. Because adjacent
events share \(x\) and \(y\), the mass of points has similar distributions (notice
that this is not the case with very few points). Unless you are displaying
another data dimension using color / size of the circles (like in the original
<a href="https://districtdatalabs.silvrback.com/time-maps-visualizing-discrete-events-across-many-timescales">blog</a>, where we see points colored according to the time of day), the two
dimensions here just add to the visual clutter.
</p>

<hr>

<p>
Lets tweak the lastfm data a little bit. Now, the scrobbles are filtered to show
only the first listen of each song. To give this some meaning, a lot of these
<i>filtered</i> scrobbles in a short time span would mean that I explored more as
compared to repeating the same old songs.
</p>

<figure> <div id='diffs-lfm-dd'></div> <figcaption>
<p>
First listen time maps
</p>
</figcaption></figure>

<p>
Notice how easy it is to find the bumps in the marginal plot. A plot of \(x\)
marginal follows.
</p>

<figure> <div id='dd-hist'></div> <figcaption>
<p>
\(x\) marginal plot of first listens
</p>
</figcaption></figure>

<p>
As a side note this plot makes me wonder about the origin of the bumps. The
initial rise up to \(x = 3, 4\) (around 20, 50 minutes) is mostly due to radios
listens (which give you fresh songs frequently) or binging on some new
album/artist. The one around 7 (around 18 hours) might be a <i>session</i> change. A
new session, with fresh items probably. Need to dig in the actual songs to
understand this.
</p>

<div id="outline-container-org1ea7a5d" class="outline-2">
<h2 id="tweets"><a id="org1ea7a5d"></a><span class="section-number-2">1</span> Tweets</h2>
<div class="outline-text-2" id="text-tweets">

<p>
The original blog made a time map for tweets of <a href="https://twitter.com/BarackObama">@BarackObama</a>. I did a re-crawl.
Here is the time plot of tweets per day.
</p>

<figure> <div id='counts-tw'></div> <figcaption>
<p>
Tweets per day <a href="https://twitter.com/BarackObama">@BarackObama</a>
</p>
</figcaption></figure>

<p>
Next is the full time map for the series.
</p>

<figure> <div id='diffs-tw'></div> <figcaption>
<p>
Tweets time map <a href="https://twitter.com/BarackObama">@BarackObama</a>
</p>
</figcaption></figure>

<p>
As argued earlier, unless we are showing extra information, its much easier to
see the marginal to get the frequency behavior of the series. See the plot
below.
</p>

<figure> <div id='tw-hist'></div> <figcaption>
<p>
Tweets time map 1D <a href="https://twitter.com/BarackObama">@BarackObama</a>.
</p>
</figcaption></figure>
</div>
</div>

<div id="outline-container-orgda80427" class="outline-2">
<h2 id="gotchas"><a id="orgda80427"></a><span class="section-number-2">2</span> Gotchas</h2>
<div class="outline-text-2" id="text-gotchas">

<ul class="org-ul">
<li>Making sense of a histogram in log scale (the kind I used, with uniform bins
over log scaled data; You can have non-uniform, log scaled bins too. I haven't
tried that) is tricky. The bins and density don't exactly go as you would
think. Additionally you would see repeated pattern (exposing the discrete
values) in the beginning and smoothing in the end. More rigorous analysis
should be done to derive something other than qualitative meanings from these.</li>
<li>Add to it the number-of-bins problem. Plots above use <a href="https://en.wikipedia.org/wiki/Freedman%E2%80%93Diaconis_rule">Freedman-Diaconis rule</a>
to get the number of bins. Changing this number can result in different views
as shown below.</li>
</ul>

<figure> <div id='tw-hist-less'></div> <figcaption>
<p>
Tweets time map with 10 bins
</p>
</figcaption></figure>

<figure> <div id='tw-hist-more'></div> <figcaption>
<p>
Tweets time map with 200 bins
</p>
</figcaption></figure>

<hr>

<p>
Time maps are neat exploratory tools. To me, they have more qualitative value
than quantitative. Most of the visualizations with more than a few dozen points
make more sense qualitatively and are better without unnecessary details, that's
why we prefer heatmaps instead of regular scatter in certain cases. A marginal
time map follows the same idea.
</p>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="./tufte.min.js"></script>
<script src="./script.js"></script>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer id='footer'></footer>
</div>
</body>
</html>
